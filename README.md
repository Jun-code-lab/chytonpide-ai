# ğŸŒ± Chytonpide AI - Basil Health Analyzer API v1.2.0

**ë°”ì§ˆ ì‹ë¬¼ì˜ ê±´ê°• ìƒíƒœë¥¼ ë¶„ì„í•˜ê³  ì—½ë©´ì (PLA)ì„ ê³„ì‚°í•˜ëŠ” AI ì„œë¹„ìŠ¤**

**í•µì‹¬ ê¸°ìˆ **: YOLO11 (ê°ì²´ íƒì§€ + ë¶„ë¥˜) + **FastSAM** (ì„¸ê·¸ë©˜í…Œì´ì…˜)

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
chytonpide-ai/
â”‚
â”œâ”€â”€ ğŸš€ my_ai_service/                      # â­ FastAPI AI ì„œë¹„ìŠ¤ (ë©”ì¸)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py                        # FastAPI v1.0.0
â”‚   â”‚   â”‚   â”œâ”€â”€ GET /                      # API ì •ë³´
â”‚   â”‚   â”‚   â”œâ”€â”€ GET /health                # í—¬ìŠ¤ ì²´í¬
â”‚   â”‚   â”‚   â””â”€â”€ POST /analyze              # ì‹ë¬¼ ë¶„ì„
â”‚   â”‚   â”œâ”€â”€ ai_logic.py                    # â­ BasilAnalyzer í´ë˜ìŠ¤ (í•µì‹¬)
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__()                 # YOLO11 + FastSAM ëª¨ë¸ ë¡œë”©
â”‚   â”‚   â”‚   â”œâ”€â”€ _separate_overlapping_leaves()  # Watershed ì•Œê³ ë¦¬ì¦˜
â”‚   â”‚   â”‚   â”œâ”€â”€ _count_leaves()            # FastSAM + Watershedë¡œ ì ê°œìˆ˜
â”‚   â”‚   â”‚   â”œâ”€â”€ _calculate_pla()           # ì—½ë©´ì (PLA) ê³„ì‚°
â”‚   â”‚   â”‚   â””â”€â”€ process()                  # ì „ì²´ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
â”‚   â”‚   â””â”€â”€ config.py                      # ì„¤ì • ìƒìˆ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ weights/
â”‚   â”‚   â”œâ”€â”€ det_best.pt                    # YOLO11 íƒì§€ (Scale + Basil)
â”‚   â”‚   â”œâ”€â”€ cls_best.pt                    # YOLO ë¶„ë¥˜ (Healthy/Unhealthy)
â”‚   â”‚   â””â”€â”€ FastSAM-x.pt                   # FastSAM ëª¨ë¸
â”‚   â”‚
â”‚   â”œâ”€â”€ .dockerignore
â”‚   â”œâ”€â”€ Dockerfile                         # Docker ì´ë¯¸ì§€
â”‚   â”œâ”€â”€ requirements.txt                   # ì˜ì¡´ì„±: FastAPI, OpenCV, Ultralytics FastSAM ë“±
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â”œâ”€â”€ SYSTEM_OVERVIEW.md
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ ğŸ“š train_cls.py, train_det.py          # YOLO í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ predict_cls.py, predict_det.py         # ì˜ˆì¸¡ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ calculate_pla.py                       # PLA ë…ë¦½ ê³„ì‚°
â”‚
â”œâ”€â”€ âš™ï¸ configs/                            # YOLO ì„¤ì •
â”œâ”€â”€ ğŸ“Š runs/                               # í•™ìŠµ ê²°ê³¼
â”œâ”€â”€ ğŸ”¬ segmentation_code/                  # FastSAM ì‹¤í—˜ ì½”ë“œ
â””â”€â”€ CHANGELOG.md
```

---

## ğŸ”„ AI ì²˜ë¦¬ íë¦„ (ai_logic.py)

### BasilAnalyzer.process() ì „ì²´ íŒŒì´í”„ë¼ì¸

```
ì‚¬ìš©ì ì´ë¯¸ì§€
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ ì´ë¯¸ì§€ ì „ì²˜ë¦¬               â”‚
â”‚ (ë¡œë“œ, EXIF íšŒì „, BGR ë³€í™˜)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ YOLO11 ê°ì²´ íƒì§€            â”‚
â”‚ âœ“ Scale ë§ˆì»¤ ê²€ì¶œ (ID:1)       â”‚
â”‚ âœ“ ë°”ì§ˆ ì‹ë¬¼ ê²€ì¶œ (ID:0)        â”‚
â”‚ âœ“ ë°”ìš´ë”©ë°•ìŠ¤ ì¢Œí‘œ ì¶”ì¶œ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ Scale ìŠ¤ì¼€ì¼ ê³„ì‚°           â”‚
â”‚ mm/pixel = 16mm / Scaleì§€ë¦„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ ë°”ì§ˆ í¬ë¡­ ì¶”ì¶œ              â”‚
â”‚ (ì‹ë¬¼ ë¶€ë¶„ë§Œ ìë¥´ê¸°)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£ FastSAM ì„¸ê·¸ë©˜í…Œì´ì…˜       â”‚
â”‚ self.sam_model(basil_crop_bgr)  â”‚
â”‚ â†’ ì—¬ëŸ¬ ë§ˆìŠ¤í¬ ì´ë¯¸ì§€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6ï¸âƒ£ Watershedë¡œ ê²¹ì¹œ ì ë¶„ë¦¬   â”‚
â”‚ FastSAM ë§ˆìŠ¤í¬ + Watershed      â”‚
â”‚ â†’ leaf_count ê³„ì‚°               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7ï¸âƒ£ PLA(ì—½ë©´ì ) ê³„ì‚°            â”‚
â”‚ HSV ì´ˆë¡ìƒ‰ í•„í„° + ìŠ¤ì¼€ì¼        â”‚
â”‚ â†’ pla_mm2, pla_cm2             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8ï¸âƒ£ ì§ˆë³‘ ë¶„ë¥˜ (YOLO)            â”‚
â”‚ â†’ diagnosis: healthy/unhealthy â”‚
â”‚ â†’ confidence %                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
         JSON ì‘ë‹µ
```

---

## ğŸ“Š ê° ë‹¨ê³„ ìƒì„¸

### 1ï¸âƒ£ YOLO11 ê°ì²´ íƒì§€ (det_best.pt)
- **ëª©í‘œ**: Scale ë§ˆì»¤(16mm) + ë°”ì§ˆ ì‹ë¬¼ ê²€ì¶œ
- **ì…ë ¥**: ì›ë³¸ ì´ë¯¸ì§€
- **ì¶œë ¥**: 2ê°œ í´ë˜ìŠ¤ (ID 0=Basil, ID 1=Scale)
- **ì‹ ë¢°ë„**: 0.15 (ë‚®ì¶¤, ì‘ì€ ìŠ¤í‹°ì»¤ë„ ê°ì§€)
- **ì†Œìš”ì‹œê°„**: ~800ms

### 2ï¸âƒ£ FastSAM ì„¸ê·¸ë©˜í…Œì´ì…˜ (FastSAM-x.pt)
```python
# ai_logic.py 71-88ë²ˆ ì¤„
results = self.sam_model(basil_crop_bgr)
masks = results[0].masks.data.cpu().numpy()  # ì—¬ëŸ¬ ë§ˆìŠ¤í¬ ë°˜í™˜
```
- **ëª©í‘œ**: ë°”ì§ˆ ì´ë¯¸ì§€ë¥¼ ì—¬ëŸ¬ ì˜ì—­ìœ¼ë¡œ ë¶„í• 
- **ì…ë ¥**: ë°”ì§ˆ í¬ë¡­ (YOLO íƒì§€ ê²°ê³¼)
- **ì¶œë ¥**: ì—¬ëŸ¬ ë§ˆìŠ¤í¬ (ê°ê°ì´ í•˜ë‚˜ì˜ ê°ì²´)
- **ì†Œìš”ì‹œê°„**: ~1000ms

### 3ï¸âƒ£ Watershedë¡œ ê²¹ì¹œ ì ë¶„ë¦¬ (_count_leaves)
```python
# FastSAM ë§ˆìŠ¤í¬ â†’ Watershedë¡œ ë¶„ë¦¬
markers = self._separate_overlapping_leaves(mask_uint8)
```
1. ê° FastSAM ë§ˆìŠ¤í¬ì— ëŒ€í•´:
   - HSV ì´ˆë¡ìƒ‰ í•„í„°ë§ (H: 35-85)
   - ì´ˆë¡ìƒ‰ ë¹„ìœ¨ 50% ì´ìƒ í™•ì¸

2. Watershed ì•Œê³ ë¦¬ì¦˜ ì ìš©:
   - Distance Transform
   - í™•ì‹¤í•œ ì „ê²½/ë°°ê²½ êµ¬ë¶„
   - Watershed ìˆ˜í–‰

3. ë¶„ë¦¬ëœ ê° ì˜ì—­ ê²€ì¦:
   - í¬ê¸° 100px ì´ìƒ?
   - ì´ˆë¡ìƒ‰ ë¹„ìœ¨ 40% ì´ìƒ?
   - ììœ¼ë¡œ ì¹´ìš´íŠ¸

**ê²°ê³¼**: ì ê°œìˆ˜, ê° ìì˜ ë©´ì 

### 4ï¸âƒ£ PLA ê³„ì‚° (_calculate_pla)
```python
# ì´ˆë¡ìƒ‰ í”½ì…€ ê¸°ë°˜ ë©´ì  ê³„ì‚°
green_mask = cv2.inRange(hsv, lower_green, upper_green)
green_pixel_count = cv2.countNonZero(green_mask)
area_mm2 = green_pixel_count * (mm_per_pixel ** 2)
```
- **ì…ë ¥**: ë°”ì§ˆ í¬ë¡­ ì´ë¯¸ì§€, mm_per_pixel
- **ì²˜ë¦¬**: HSV í•„í„° + ëª¨í´ë¡œì§€ ì—°ì‚° (ë…¸ì´ì¦ˆ ì œê±°)
- **ì¶œë ¥**: pla_mm2, pla_cm2, green_pixels

---

## â±ï¸ ì„±ëŠ¥

| ë‹¨ê³„ | ì†Œìš”ì‹œê°„ |
|------|---------|
| ì´ë¯¸ì§€ ì „ì²˜ë¦¬ | ~100ms |
| YOLO11 íƒì§€ | ~800ms |
| FastSAM ì„¸ê·¸ë©˜í…Œì´ì…˜ | ~1000ms |
| Watershed + ì ê°œìˆ˜ | ~200ms |
| PLA ê³„ì‚° | ~100ms |
| YOLO ë¶„ë¥˜ | ~400ms |
| **ì´í•©** | **~2.6ì´ˆ** |

> ğŸ“Œ ì²« ìš”ì²­: +3000ms (ëª¨ë¸ ë¡œë”©)

ì‹¤ì œ ì„œë²„í†µì‹  ë° cpu í™˜ê²½ì—ì„œ 

ì•½ 10~15ì´ˆ ê±¸ë¦¼
---

## ğŸš€ ì„¤ì¹˜ & ì‹¤í–‰

### ë¡œì»¬ ê°œë°œ
```bash
cd my_ai_service
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Docker
```bash
docker build -t basil-analyzer:v1.0.0 .
docker run -p 8000:8000 basil-analyzer:v1.0.0
```

---

## ğŸ“¡ API

### POST /analyze
```bash
curl -X POST "http://localhost:8000/analyze" \
  -F "file=@plant_image.jpg"
```

**ì‘ë‹µ:**
```json
{
  "status": "success",
  "data": {
    "diagnosis": "healthy",
    "confidence": "95.50%",
    "pla_mm2": 2500.45,
    "pla_cm2": 25.00,
    "leaf_count": 12,
    "growth_stage": "Mature"
  }
}
```

**ì‘ë‹µ í•„ë“œ ì„¤ëª…:**
- `diagnosis`: ì‹ë¬¼ ìƒíƒœ (healthy/unhealthy)
- `confidence`: ë¶„ë¥˜ ì‹ ë¢°ë„ (%)
- `pla_mm2`: ì—½ë©´ì  (ì œê³±ë°€ë¦¬ë¯¸í„°)
- `pla_cm2`: ì—½ë©´ì  (ì œê³±ì„¼í‹°ë¯¸í„°)
- `leaf_count`: ì ê°œìˆ˜
- `growth_stage`: ì„±ì¥ ë‹¨ê³„ (Seedling/Vegetative/Mature/Full Growth)

---

## ğŸ“š ì¶”ê°€ ë¬¸ì„œ

- [API ìƒì„¸](my_ai_service/README.md)
- [ì•„í‚¤í…ì²˜](my_ai_service/ARCHITECTURE.md)
- [ë°°í¬ ê°€ì´ë“œ](my_ai_service/SYSTEM_OVERVIEW.md)
- [ë³€ê²½ ê¸°ë¡](CHANGELOG.md)

---

**ìµœì¢… ìˆ˜ì •**: 2025-11-29
